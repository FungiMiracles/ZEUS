{% extends "base_layout.html" %}
{% block title %}Generator miast technicznych{% endblock %}

{% block content %}

<style>
.generator-box {
    max-width: 900px;
    margin: 30px auto;
    background: #ffffff;
    border-radius: 14px;
    padding: 26px 30px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    font-family: "Segoe UI", Tahoma, sans-serif;
    color: #2c3e50;
}

.generator-box h1 {
    text-align: center;
    font-size: 1.6em;
    font-weight: 800;
    margin-bottom: 25px;
}

.generator-section {
    margin-bottom: 26px;
}

.generator-section h3 {
    font-size: 1.05em;
    font-weight: 800;
    margin-bottom: 12px;
    color: #34495e;
}

.generator-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
}

.generator-grid label {
    font-size: 0.8em;
    font-weight: 800;
    margin-bottom: 4px;
    display: block;
}

.generator-grid select,
.generator-grid input {
    width: 100%;
    padding: 8px 10px;
    border-radius: 7px;
    border: 1px solid #bdc3c7;
    font-size: 0.9em;
}

.generator-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 30px;
}

.btn-main {
    padding: 10px 22px;
    border-radius: 8px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    font-size: 0.95em;
}

.btn-green {
    background: #27ae60;
    color: white;
}

.btn-gray {
    background: #ecf0f1;
    border: 1.5px solid #bdc3c7;
    color: #34495e;
}

.zeus-msg {
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 18px;
    font-weight: 700;
    text-align: center;
}

.zeus-success {
    background: #d4edda;
    color: #155724;
}

.zeus-error {
    background: #f8d7da;
    color: #721c24;
}

.zeus-warning {
    background: #fff3cd;
    color: #856404;
}
</style>

<div class="generator-box">

    <h1>Generator miast technicznych</h1>

    <!-- KOMUNIKATY -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="zeus-msg
                    {% if category == 'success' %}zeus-success
                    {% elif category == 'error' %}zeus-error
                    {% elif category == 'warning' %}zeus-warning
                    {% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if warning %}
        <div class="zeus-msg zeus-warning">
            {{ warning }}
        </div>
    {% endif %}

    {% if error %}
        <div class="zeus-msg zeus-error">
            {{ error }}
        </div>
    {% endif %}

    <form method="POST">

        {% if confirm_required %}
            <input type="hidden" name="confirm" value="yes">
            {% for k, v in form_data.items() %}
                <input type="hidden" name="{{ k }}" value="{{ v }}">
            {% endfor %}
        {% endif %}

        <!-- ===== LOKALIZACJA ===== -->
        <div class="generator-section">
            <h3>Lokalizacja</h3>
            <div class="generator-grid">

                <div>
                    <label>Kontynent</label>
                    <select name="kontynent" id="kontynent" required>
                        <option value="">— wybierz —</option>
                        {% for k in kontynenty %}
                            <option value="{{ k }}">{{ k }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label>Państwo</label>
                    <select name="panstwo_id" id="panstwo" required disabled>
                        <option value="">— wybierz kontynent —</option>
                    </select>
                </div>

                <div>
                    <label>Region</label>
                    <select name="region_id" id="region" required disabled>
                        <option value="">— wybierz państwo —</option>
                    </select>
                </div>

            </div>
        </div>

        <!-- ===== PARAMETRY ===== -->
        <div class="generator-section">
            <h3>Parametry generacji</h3>
            <div class="generator-grid">

                <div>
                    <label>Ilość miast</label>
                    <input type="number" name="ilosc" min="1" required>
                </div>

                <div>
                    <label>Ludność od</label>
                    <input type="number" name="min_pop" required>
                </div>

                <div>
                    <label>Ludność do</label>
                    <input type="number" name="max_pop" required>
                </div>

            </div>
        </div>

        <!-- ===== AKCJE ===== -->
        <div class="generator-actions">
            <button class="btn-main btn-green" type="submit">
                Zrzuć do bazy
            </button>
            <a href="{{ url_for('home_page') }}" class="btn-main btn-gray">
                Anuluj
            </a>
        </div>

    </form>
</div>

<script>
document.getElementById("kontynent").addEventListener("change", function () {
    const kontynent = this.value;
    const panstwoSelect = document.getElementById("panstwo");
    const regionSelect = document.getElementById("region");

    panstwoSelect.innerHTML = "<option>Ładowanie…</option>";
    panstwoSelect.disabled = true;
    regionSelect.innerHTML = "<option>— wybierz państwo —</option>";
    regionSelect.disabled = true;

    if (!kontynent) return;

    fetch(`/api/panstwa_by_kontynent?kontynent=${kontynent}`)
        .then(res => res.json())
        .then(data => {
            panstwoSelect.innerHTML = '<option value="">— wybierz —</option>';
            data.forEach(p => {
                panstwoSelect.innerHTML +=
                    `<option value="${p.PANSTWO_ID}">${p.panstwo_nazwa}</option>`;
            });
            panstwoSelect.disabled = false;
        });
});

document.getElementById("panstwo").addEventListener("change", function () {
    const panstwoId = this.value;
    const regionSelect = document.getElementById("region");

    regionSelect.innerHTML = "<option>Ładowanie…</option>";
    regionSelect.disabled = true;

    if (!panstwoId) return;

    fetch(`/api/regiony_by_panstwo?panstwo_id=${panstwoId}`)
        .then(res => res.json())
        .then(data => {
            regionSelect.innerHTML = '<option value="">— wybierz —</option>';
            data.forEach(r => {
                regionSelect.innerHTML +=
                    `<option value="${r.region_id}">${r.region_nazwa}</option>`;
            });
            regionSelect.disabled = false;
        });
});
</script>

{% endblock %}
